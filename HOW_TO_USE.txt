================================================================================
                    VAULTCTL - HOW TO USE GUIDE
================================================================================

vaultctl is a zero-knowledge CLI password manager with client-side encryption.
All encryption and decryption happens locally. The server (DynamoDB) only
stores encrypted blobs and never sees your master password or decrypted data.

================================================================================
                            INSTALLATION
================================================================================

1. PREREQUISITES
   - Go 1.23 or later installed
   - AWS CLI configured (for DynamoDB access)
   - AWS account with DynamoDB access

2. BUILD THE APPLICATION
   cd /path/to/emerald-blossom-dreamstone
   go mod download
   go build -o vaultctl

   This creates an executable named "vaultctl" in the current directory.

3. INSTALL (OPTIONAL)
   You can move the vaultctl binary to a directory in your PATH:
   sudo mv vaultctl /usr/local/bin/
   
   Or install via Go:
   go install

================================================================================
                            INITIAL SETUP
================================================================================

STEP 1: CREATE DYNAMODB TABLE

Create a DynamoDB table in your AWS account:

Table name: vaultctl_vaults
Partition key: PK (String)
Sort key: SK (String)

You can create this via:
- AWS Console: https://console.aws.amazon.com/dynamodb
- AWS CLI: 
  aws dynamodb create-table \
    --table-name vaultctl_vaults \
    --attribute-definitions AttributeName=PK,AttributeType=S AttributeName=SK,AttributeType=S \
    --key-schema AttributeName=PK,KeyType=HASH AttributeName=SK,KeyType=RANGE \
    --billing-mode PAY_PER_REQUEST

STEP 2: CONFIGURE AWS CREDENTIALS

Choose one of these methods:

A) AWS CLI Configuration:
   aws configure
   Enter your AWS Access Key ID, Secret Access Key, region, and output format

B) Environment Variables:
   export AWS_ACCESS_KEY_ID=your_access_key
   export AWS_SECRET_ACCESS_KEY=your_secret_key
   export AWS_DEFAULT_REGION=us-east-1

C) IAM Role (if running on EC2):
   Attach an IAM role with DynamoDB permissions to your EC2 instance

STEP 3: SET UP IAM PERMISSIONS

Your AWS user/role needs these DynamoDB permissions:
- dynamodb:GetItem
- dynamodb:PutItem

Minimum IAM policy:
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "dynamodb:GetItem",
        "dynamodb:PutItem"
      ],
      "Resource": "arn:aws:dynamodb:*:*:table/vaultctl_vaults"
    }
  ]
}

STEP 4: INITIALIZE YOUR VAULT

Run the init command:
  vaultctl init

You will be prompted to:
  1. Enter a master password (this encrypts your vault)
  2. Confirm the master password

IMPORTANT: Remember your master password! If you lose it, you cannot
recover your vault. The master password is never stored anywhere.

After initialization, your vault is created locally at:
  ~/.vaultctl/vault.db

And synced to DynamoDB (if configured).

================================================================================
                            BASIC USAGE
================================================================================

UNLOCK THE VAULT

Before using most commands, you need to unlock the vault:
  vaultctl unlock

Enter your master password when prompted. The vault stays unlocked for the
duration of your CLI session.

Note: Some commands (like add, get, list) will automatically prompt you to
unlock if the vault is locked.

ADD A PASSWORD ENTRY

Add a new password entry:
  vaultctl add --name github --username user@example.com --url https://github.com/login --notes "2FA enabled"

Flags:
  --name     (required) Name/identifier for the entry
  --username (optional) Username or email
  --url      (optional) Website URL
  --notes    (optional) Additional notes
  --no-sync  (optional) Don't sync to DynamoDB after adding

The password will be prompted securely (hidden input).

Example:
  vaultctl add --name "Work Email" --username "john@company.com"
  Enter password: [hidden]

GET A PASSWORD ENTRY

Retrieve a password entry by name or ID:
  vaultctl get github
  vaultctl get <entry-id>

This displays all information for the entry including the password.

LIST ALL ENTRIES

List all entries without showing passwords:
  vaultctl list

Output shows: Name, Username, URL, Last Updated

REMOVE AN ENTRY

Delete an entry:
  vaultctl remove github
  vaultctl remove <entry-id>

Flags:
  --no-sync  (optional) Don't sync to DynamoDB after removing

SYNC WITH DYNAMODB

Sync your local vault with the remote DynamoDB vault:
  vaultctl sync

This will:
- Pull the latest version from DynamoDB if it's newer
- Push your local changes if they're newer
- Handle version conflicts

If there's a conflict, you'll be prompted to resolve it.

CREATE A BACKUP

Create an encrypted backup of your vault:
  vaultctl backup

This creates a backup file at:
  ~/.vaultctl/backups/vault-YYYY-MM-DDTHH-MM-SSZ.enc

Or specify a custom path:
  vaultctl backup /path/to/backup.enc

The backup is encrypted with the same encryption as your vault.

ROTATE MASTER PASSWORD

Change your master password:
  vaultctl rotate-master

You will be prompted to:
  1. Enter your current master password
  2. Enter your new master password
  3. Confirm your new master password

This re-encrypts your vault key with the new master password. Your
entries remain unchanged.

================================================================================
                            CONFIGURATION
================================================================================

Configuration is stored at: ~/.vaultctl/config.json

Default configuration:
{
  "aws_region": "us-east-1",
  "table_name": "vaultctl_vaults",
  "user_id": "default",
  "vault_path": "~/.vaultctl/vault.db"
}

You can edit this file directly to change:
- AWS region
- DynamoDB table name
- User ID (for multi-user scenarios)
- Local vault file path

The config file is created automatically on first use.

================================================================================
                            EXAMPLES
================================================================================

EXAMPLE 1: Complete Workflow

1. Initialize vault:
   vaultctl init
   Enter master password: ********
   Confirm master password: ********
   Vault initialized and synced to DynamoDB

2. Add entries:
   vaultctl add --name "Gmail" --username "me@gmail.com" --url "https://gmail.com"
   Enter password: ********
   Entry 'Gmail' added successfully

   vaultctl add --name "GitHub" --username "developer" --url "https://github.com"
   Enter password: ********
   Entry 'GitHub' added successfully

3. List entries:
   vaultctl list
   NAME    USERNAME    URL                  UPDATED
   Gmail   me@gmail.com https://gmail.com    2025-01-16 10:30:00
   GitHub  developer   https://github.com    2025-01-16 10:31:00

4. Get an entry:
   vaultctl get Gmail
   Name: Gmail
   Username: me@gmail.com
   Password: mypassword123
   URL: https://gmail.com
   Created: 2025-01-16 10:30:00
   Updated: 2025-01-16 10:30:00

5. Sync with remote:
   vaultctl sync
   Vault synced successfully (version 3)

EXAMPLE 2: Working Offline

If DynamoDB is not available, you can still use vaultctl locally:

1. Unlock vault:
   vaultctl unlock
   Enter master password: ********
   Vault unlocked successfully

2. Add entries (they won't sync, but will be saved locally):
   vaultctl add --name "Local Entry" --no-sync

3. When DynamoDB is available again:
   vaultctl sync

EXAMPLE 3: Backup and Restore

1. Create backup:
   vaultctl backup
   Backup created at: ~/.vaultctl/backups/vault-2025-01-16T10-00-00Z.enc

2. To restore from backup:
   - Copy the backup file to your vault location
   - Or use it as a reference (it's encrypted, so you still need master password)

================================================================================
                            TROUBLESHOOTING
================================================================================

PROBLEM: "DynamoDB not available" warning

SOLUTION:
- Check AWS credentials are configured: aws configure list
- Verify AWS region matches your DynamoDB table region
- Ensure DynamoDB table exists and is accessible
- Check IAM permissions include dynamodb:GetItem and dynamodb:PutItem

Note: The vault works locally even without DynamoDB. You just won't have
cloud sync until DynamoDB is configured.

PROBLEM: "version conflict" error

SOLUTION:
- Run: vaultctl sync
- This will sync your local vault with the remote version
- If conflicts persist, you may need to manually resolve by choosing
  which version to keep

PROBLEM: "vault not found" error

SOLUTION:
- Run: vaultctl init
- This creates a new vault
- If you had an existing vault, check the vault_path in config.json

PROBLEM: "failed to unlock vault" error

SOLUTION:
- Verify you're using the correct master password
- Check that the vault file exists at the configured path
- Ensure you have read permissions on the vault file
- If vault is corrupted, restore from backup

PROBLEM: "failed to decrypt" error

SOLUTION:
- Verify master password is correct
- Check that vault file is not corrupted
- Try restoring from a backup if available
- Ensure you're using the same vault file that was encrypted

PROBLEM: Command not found

SOLUTION:
- Ensure vaultctl is in your PATH, or
- Use full path: /path/to/vaultctl [command]
- Or run from the build directory: ./vaultctl [command]

================================================================================
                            SECURITY BEST PRACTICES
================================================================================

1. MASTER PASSWORD
   - Use a strong, unique master password
   - Consider using a passphrase (multiple words)
   - Never share your master password
   - Store it securely (password manager, physical safe, etc.)

2. VAULT FILE
   - The vault file is encrypted, but still protect it
   - Don't share the vault file
   - Regular backups are recommended
   - Store backups in secure locations

3. AWS CREDENTIALS
   - Use IAM roles when possible (more secure than access keys)
   - Rotate access keys regularly
   - Use least-privilege IAM policies
   - Never commit AWS credentials to version control

4. ENVIRONMENT
   - Run vaultctl on trusted machines only
   - Be cautious when using on shared systems
   - Clear terminal history if passwords were displayed
   - Lock your screen when not using the terminal

5. BACKUPS
   - Create regular backups: vaultctl backup
   - Store backups in multiple secure locations
   - Test backup restoration periodically
   - Encrypt backup storage if storing in cloud

================================================================================
                            FILE LOCATIONS
================================================================================

Default file locations (on Unix-like systems):

Configuration:
  ~/.vaultctl/config.json

Vault file:
  ~/.vaultctl/vault.db

Backups:
  ~/.vaultctl/backups/vault-*.enc

On Windows, replace ~ with %USERPROFILE%

================================================================================
                            ADVANCED USAGE
================================================================================

CUSTOM TABLE NAME

If you want to use a different DynamoDB table:

1. Edit ~/.vaultctl/config.json:
   {
     "table_name": "my_custom_table"
   }

2. Or create the table with your custom name in DynamoDB

MULTI-USER SCENARIOS

For multiple users sharing the same DynamoDB table:

1. Set different user_id in config.json for each user:
   {
     "user_id": "user1"
   }

2. Each user's vault will be stored separately in DynamoDB with:
   PK: USER#user1
   SK: VAULT

OFFLINE MODE

vaultctl works completely offline. DynamoDB is optional for:
- Multi-device sync
- Cloud backup
- Remote access

All operations work locally without DynamoDB.

================================================================================
                            COMMAND REFERENCE
================================================================================

vaultctl init
  Initialize a new vault

vaultctl unlock
  Unlock the vault with master password

vaultctl add [flags]
  Add a new password entry
  Flags: --name, --username, --url, --notes, --no-sync

vaultctl get <name_or_id>
  Get a password entry by name or ID

vaultctl list
  List all entries (without passwords)

vaultctl remove <name_or_id> [flags]
  Remove an entry by name or ID
  Flags: --no-sync

vaultctl sync
  Sync vault with DynamoDB

vaultctl backup [output_path]
  Create an encrypted backup

vaultctl rotate-master
  Change the master password

vaultctl --help
  Show help for vaultctl

vaultctl [command] --help
  Show help for a specific command

================================================================================
                            SUPPORT
================================================================================

For issues, questions, or contributions:
- Check the README.md file
- Review the DESIGNDOC.md for architecture details
- Ensure all prerequisites are met
- Verify AWS configuration

Remember: This is a zero-knowledge password manager. If you lose your
master password, your vault cannot be recovered. Always maintain backups!

================================================================================
                            END OF GUIDE
================================================================================

